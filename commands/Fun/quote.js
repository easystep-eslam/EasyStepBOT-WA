const fetch = require('node-fetch');
const { getLang } = require('../../lib/lang');

const QUOTES_AR = [
  "ุงููู ูุงุช ูุงุชุ ูุงููู ุฌุงู ูุณู ูุชูุชุจุด โจ",
  "ูุจุฑ ุฏูุงุบูโฆ ุงูุฏููุง ูุด ูุณุชุงููุฉ ๐",
  "ูุด ูู ุงููู ุจูุถุญู ูุจุณูุท ๐",
  "ุงูุฑุงุญุฉ ุฃุญูุงููุง ูู ุงูุชุฌุงูู ูุด ูู ุงูุฑุฏ",
  "ุฎููู ุจุณูุทุ ุงูุจุณุงุทุฉ ููุฉ ๐ช",
  "ุงููุฏูุก ูุนูุฉุ ูุงูุฑุงุญุฉ ุงุฎุชูุงุฑ",
  "ูุด ูู ุฎุณุงุฑุฉ ุดุฑุ ุฃุญูุงููุง ูุฌุงุฉ",
  "ุงููู ุนุงูุฒู ุจุฌุฏ ูุด ููุณููุจู",
  "ุฎุฏ ุงูุฃููุฑ ุจูุฏูุกโฆ ููู ุจูุนุฏูู โณ",
  "ุฑุถุง ุงูููุณ ุฃุบูู ูู ุฑุถุง ุงููุงุณ",
  "ุงููู ุจูุชุนุจ ุงูููุงุฑุฏูุ ุจูุฑุชุงุญ ุจูุฑุฉ ุฅู ุดุงุก ุงููู",
  "ุณูุจูุง ุนูู ุงูููโฆ ุฏุงูููุง ุจูุณุชุฑูุง",
  "ูุชูุงุฑูุด ููุณู ุจุญุฏโฆ ูู ูุงุญุฏ ูู ุทุฑููู",
  "ุงูููุฉ ุงูุทูุจุฉ ุฑุฒู",
  "ุงููู ูููู ุฑุงุญ ููุถู ููููโฆ ุจุณ ุงุชุนูู ุชุชุญูู",
  "ูููุด ุญุฏ ูุงููโฆ ุจุณ ูู ูุงุณ ุจุชุญุงูู",
  "ุฃููุงุช ุงูุตูุช ุฃููู ุฑุฏ",
  "ูุด ูุงุฒู ุชุฑุฏ ุนูู ูู ุญุงุฌุฉโฆ ุณูุงูู ุฃูู",
  "ุฅูุนู ุชุฏู ุญุฏ ุฃูุจุฑ ูู ุญุฌูู",
  "ุงูุฏููุง ุจุชุนูููโฆ ุจุณ ุงููุงุณู ูููุง ูุชูุฑ",
  "ูุชุฒุนูุด ุนูู ุงููู ูุด ููุฏูุฑู",
  "ุจุนุถ ุงููุงุณ ูุฌูุฏูุง ุฑุงุญุฉโฆ ูุจุนุถูู ุบูุงุจ",
  "ุงุชุนุงูู ุจุฃุตููโฆ ูุด ุจุฃุตู ุบูุฑู",
  "ูุชุฎููุด ุญุฏ ูุทููู ููุฑู",
  "ุงููู ุฑุจูุง ูุงุชุจู ูู ููุฌูููโฆ ููู ุงุชุฃุฎุฑ",
  "ุฎููู ูุงูุฑ: ุงููู ููุฌุนู ุงูููุงุฑุฏู ููููููู ุจูุฑุฉ",
  "ูุด ูู ุงููู ุจูุจุงู ุญูููุฉ",
  "ุฃุฌูู ุงูุชุตุงุฑ ุฅูู ุชูููู ุฑุบู ูู ุญุงุฌุฉ",
  "ุงุชุนูู ุชููู: ูุงโฆ ูู ุบูุฑ ูุง ุชุจุฑุฑ",
  "ุงูุฑุถุง ุจูุบููุฑ ุดูู ุงูุฏููุง ูู ุนููู",
  "ุงูุทุจุทุจุฉ ุณุงุนุงุช ุฃูู ูู ุงูุญู",
  "ุงููููุจ ุงููู ุจุชุณุงูุญโฆ ุฏู ููุฒ",
  "ูุชูููุด ุนูุฏ ุญุฏโฆ ุงููู ููุดู ููุดู",
  "ุงููู ูุญุจู ุจุฌุฏ ููุญุงูุธ ุนููู",
  "ุฎุฏ ููุชูโฆ ูููุด ุณุจุงู",
  "ูุด ูุงุฒู ุชูููููโฆ ุงูููู ุชููู ููุณู",
  "ุงููู ุฑุงุญ ูุด ููุฑุฌุน ุฒู ุงูุฃููโฆ ุญุชู ูู ุฑุฌุน",
  "ุงูุณุชุฑ ูุนูุฉโฆ ุงุญูุฏ ุฑุจู",
  "ุฎููู ูุฑูุจ ูู ุฑุจูุงโฆ ุชุฑุชุงุญ",
  "ุงูููุงูู ุจุชูุฑุฒ ุงููุงุณโฆ ูุด ุงูููุงู",
  "ูุชุณุฃูุด ูุชูุฑโฆ ุงููู ุนุงูุฒ ูููู ููููู",
  "ุญูุณู ุงูุธู ุฑุงุญุฉโฆ ูุณูุก ุงูุธู ุชุนุจ",
  "ูุชุชุนุดูุด ูู ุญุฏโฆ ุนูุดุงู ูุชุชุนุจุด",
  "ุงูุนูุจ ูุด ูู ุงููู ูุจุนุฏโฆ ุงูุนูุจ ูู ุงููู ููุฌุน ูุจู ูุง ูุจุนุฏ",
  "ุงููู ุจูุญุชุฑูู ูู ุบูุงุจูโฆ ุฏู ุฌุฏุน",
  "ูุด ูู ุงุนุชุฐุงุฑ ูุฑุฌูุน ููุณ ุงูุดุนูุฑ",
  "ุงุฌุชูุฏ ูุจุงูููุง ุนูู ุฑุจูุง",
  "ุงูุฏููุง ูุด ุซุงุจุชุฉโฆ ููู ููู ูููู ุนููู",
  "ุงููู ุจููุฏูุฑูโฆ ูุชุถููุนูุด",
  "ุงุชุนูู ุชูุฑุญ ูููุณู ูู ุบูุฑ ูุง ุชุณุชูู ุญุฏ",
  "ูู ูุงุณ ุจุชุญุจูโฆ ุจุณ ูุชุนุฑูุด ุชุนุจูุฑ",
  "ูุชุฒุนูุด ุจุณุฑุนุฉโฆ ุฎููู ุฃูุฏู",
  "ุงููู ูุดููู ูู ููุจูโฆ ุนูุฑู ูุง ููุณุฑู",
  "ุงูุฑุงุญุฉ ูู ุงูุจูุนุฏ ุฃุญูุงููุง",
  "ูุด ูู ุนุดุฑุฉ ุจุชูููโฆ ุจุณ ุงุชุนูู ูููุง",
  "ุงุฏูู ูููุณู ุญููุงโฆ ูุชูุตุฑุด ูุนุงู",
  "ุงููุฑุงูุฉ ุฃูููุงโฆ ุฏุงูููุง",
  "ุงููู ูุญุจู ูุด ููุญุทู ูู ุงุฎุชูุงุฑ",
  "ุฎููู ูุงูุฑ: ุฑุจูุง ุดุงูู ูู ุญุงุฌุฉ",
  "ุจูุงุด ุชุดุฑุญ ููุณู ููู ูุด ูุงูู ูููู",
  "ุงููู ููุฌู ุนูู ูุฑุงูุชูโฆ ุณูุจู",
  "ูู ุญุงุฌุฉ ุจุชุนุฏููโฆ ุญุชู ุงูุญุฒู",
  "ุงููู ุจูุชุนุจ ูู ุณูุงุชโฆ ุฑุจูุง ุจูุนูุถู ูุชูุฑ",
  "ูุชุฎููุด ุฒุนูู ูุณุฑู ูููู",
  "ุงูููุฉ ุงูุตุงููุฉ ุจุชูุตู ูุตุงุญุจูุง",
  "ุฅุจุนุฏ ุนู ุงููู ูุณุชููููโฆ ููุฑูุจ ูู ุงููู ูุฑูุญู",
  "ุงูุงุฎุชูุงุฑ ุงูุตุญ ุฃุญูุงููุง ุจูููู ุตุนุจโฆ ุจุณ ูุฑูุญ",
  "ูุชุฑ ุงูุชูููุฑ ุจูุถูุน ุฃุญูู ุญุงุฌุงุช",
  "ุงุชุนูู ุชูุฑูู ุจูู ุงููู ุจูุญุจูโฆ ูุงููู ูุชุนูุฏ ุนููู",
  "ุงูููุช ูููู ูุจุงู ููู ูู ุดูุก",
  "ุจุนุถ ุงููุนูุฏ ุจุชููู ูุฌุงููุฉโฆ ูุด ุญูููุฉ",
  "ุญุงูุธ ุนูู ููุจูโฆ ูุด ุฃู ุญุฏ ูุณุชุงููู",
  "ูุด ูุงุฒู ุชุจุฑุฑ ุณููุชูโฆ ุงููู ูููู ููููู",
  "ูู ุชุฃุฎูุฑ ููู ุฎูุฑโฆ ุญุชู ูู ูุด ุดุงููู",
  "ุงุจุชุณูโฆ ูููู ุชููู ุฏู ุจุฏุงูุฉ ูุฑุฌ ๐"
];

async function react(sock, message, emoji) {
  try {
    await sock.sendMessage(message.key.remoteJid, {
      react: { text: emoji, key: message.key }
    });
  } catch {}
}

async function quoteCommand(sock, message) {
  const chatId = message.key.remoteJid;
  const lang = getLang(chatId);

  const TXT = {
    en: {
      failed: 'โ Failed to get quote. Please try again later!'
    },
    ar: {
      failed: 'โ ุญุตู ุฎุทุฃ ูุฃูุง ุจุญุงูู ุฃุฌูุจ ุงูุชุจุงุณ'
    }
  };

  try {
    await react(sock, message, '๐ฌ');

    if (lang === 'ar') {
      const quote = QUOTES_AR[Math.floor(Math.random() * QUOTES_AR.length)];
      await sock.sendMessage(chatId, { text: quote }, { quoted: message });
      await react(sock, message, 'โ');
      return;
    }

    const res = await fetch('https://shizoapi.onrender.com/api/texts/quotes?apikey=shizo', {
      headers: { 'User-Agent': 'Mozilla/5.0' }
    });

    if (!res.ok) throw new Error(await res.text());

    const json = await res.json();
    const quoteMessage = json?.result || 'No quote found.';

    await sock.sendMessage(chatId, { text: quoteMessage }, { quoted: message });
    await react(sock, message, 'โ');
  } catch (error) {
    console.error('Error in quote command:', error?.message || error);
    await react(sock, message, 'โ');
    await sock.sendMessage(chatId, { text: (TXT[lang] || TXT.en).failed }, { quoted: message });
  }
}

module.exports = {
  name: 'quote',
  aliases: ['quote', 'ุงูุชุจุงุณ', 'ุญููุฉ', 'quotes'],
  category: {
    ar: '๐ฏ ุฃูุงูุฑ ุงูุชุฑููู',
    en: '๐ฏ Fun Commands'
  },
  description: {
    ar: 'ูุฑุณู ุงูุชุจุงุณ/ุญููุฉ ุนุดูุงุฆูุฉ ุญุณุจ ูุบุฉ ุงูุฌุฑูุจ.',
    en: 'Send a random quote based on group language.'
  },
  usage: {
    ar: '.quote',
    en: '.quote'
  },
  emoji: '๐ฌ',
  admin: false,
  owner: false,
  showInMenu: true,
  exec: quoteCommand,
  run: quoteCommand,
  execute: quoteCommand
};