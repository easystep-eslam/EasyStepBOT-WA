const fetch = require('node-fetch');
const { getLang } = require('../../lib/lang');

const SHAYARI_AR = [
  "ุฃุญูุงููุง ูุญุชุงุฌ ุดุฎุตูุง ูุงุญุฏูุง ููุทุ ููุฌุนู ูู ุดูุก ูุจุฏู ุฃูุถู ๐",
  "ูู ุนููููู ูุทูุ ููู ุตูุชูู ุฃูุงู โจ",
  "ูุง ุฃุฌูู ุฃู ูุฌุฏ ูู ูููู ุตูุชูุง ูุจู ููุงููุง ๐",
  "ุฃูุชู ุฑุงุญุชูุง.. ุญุชู ูู ููุชู ุณุจุจ ุชุนุจูุง ุฃุญูุงููุง ๐น",
  "ุงูุทูุฃูููุฉ ุฃุดุฎุงุต.. ุญูู ุฃุญุจุจูุงูู ููููุง ุฐูู ๐๏ธ",
  "ูู ุดูุก ููุฑ.. ุฅูุง ุฃุซุฑ ุจุนุถ ุงูุฃุดุฎุงุต ๐",
  "ูุง ุดูุก ููุดุจููู.. ููุง ุฃุญุฏ โค๏ธ",
  "ุงููููุจ ุญูู ุชุฎุชุงุฑููุ ูุง ุชุณุชุดูุฑ ุงูุนูู ๐ซ",
  "ููููุง ูุทูุงุก.. ูุงูุฌููุน ููุงุชู ูุนุฑูุฉ ูุง ุชุฑูููุง ๐ค",
  "ุงุจุชุณููุงโฆ ูููู ุชููู ุฏู ุจุฏุงูุฉ ูุฑุฌ ๐",
  "ูุฌูุฏูู ูู ุญูุงุชูุง ูุนูุฉ.. ูุญูุฏ ุฑุจูุง ุนูููุง ุฏุงุฆููุง โจ",
  "ูู ูุฑุจูู ุณูุงู.. ููู ุญุฏูุซูู ุฑุงุญุฉ ๐ฟ",
  "ุฃูุชู ุงูุชูุงุตูู ุงูุฌูููุฉ ุงูุชู ูุง ุชููุณู ๐ธ",
  "ูููุง ุถุงูุช ุงูุฏููุง.. ุชุฐููุฑูุง ุฃู ูููู ุณูุฏูุง ๐ค",
  "ุฃุฌูู ูุง ูู ุงูุฃูุงูโฆ ุฃุดุฎุงุต ูุซูููู ๐",
  "ุงููููุจ ุงูุทูุจุฉ ูุซูููู.. ูุง ุชููุฏูุฑ ุจุซูู ๐",
  "ุฃูุชู ูุทุฑู ุงูุฏุนูุงุชโฆ ูุฎูุฑู ุงูุฃูููุงุช ๐ง๏ธ",
  "ููุณ ุงูุฌูุงู ุฃู ูุฑู.. ุจู ุฃู ูุดุนุฑ ุจูุฌูุฏูู โค๏ธ",
  "ุจูููุง ูุจูููู ููุฏุฉ.. ูุง ููุณุฏูุง ุฒูุงู ๐ซ",
  "ุงูุฑุงุญุฉ ููุณุช ููุงููุงโฆ ุจู ุฃุดุฎุงุตูุง ูุซูููู ๐๏ธ",
  "ุฃูุชู ุงูุฏุนูุฉ ุงูุญููุฉ ูู ุขุฎุฑ ุงูููู ๐",
  "ุญูู ุชููููู ุจุฎูุฑโฆ ูุทูุฆู ุฌููุนูุง ๐ค",
  "ูู ุงูุทุฑู ุชุตุจุญ ุฃุณููโฆ ุญูู ูููู ูุนูู ููุจ ุตุงุฏู ๐ฟ",
  "ุฃูุชู ุงูููุฑ ุญูู ูุทูู ุงูุนุชู โจ",
  "ูู ุญุถูุฑูู ุชุชูุณุน ุงูุฑูุญ ๐ธ",
  "ูุง ุฃุฌูู ุฃู ูุฌุฏ ูู ูุดุจู ุงูุทูุฃูููุฉโฆ ุฃูุชู ๐๏ธ",
  "ุงููุฏู ุฑุฒูโฆ ูุฃูุชู ูู ุฃุฌูู ุฃุฑุฒุงููุง ๐",
  "ูุง ูุทูุจ ูุซูุฑูุงโฆ ููุท ุฃู ุชุจููุง ุจุฎูุฑ ุฏุงุฆููุง ๐ค",
  "ุฃูุชู ุงูุณูุงู ุงูุฐู ูุญุชุงุฌู ุฏูู ุฃู ูููู ๐",
  "ุญูู ูุชุนุจโฆ ูููููุง ุฃู ูุชุฐููุฑ ูุทููู ๐ฟ",
  "ุชุณุชุญููู ูููุจูุง ูุง ุชูุฑููููโฆ ูุฃูุงููุง ูุง ุชูุชุนุจูู ๐ซ",
  "ุงูููู ุงุฌุนู ุฃูุงููู ุฎูููุฉโฆ ููููุจูู ูุทูุฆูุฉ ๐คฒ",
  "ุฃูุชู ุจุฏุงูุฉ ุงูููุงู ุงูุฌูููโฆ ูููุงูุชู ๐ธ",
  "ุงูุฑูุญ ุชูุฏุฃ ุญูู ุชุณูุน ุฃุณูุงุกูู ๐ค",
  "ุฌููู ุฃู ูููู ููุง ูู ุงูุญูุงุฉ ุฃุดุฎุงุตโฆ ูุซูููู โจ",
  "ุฃูุชู ุงูุฃูุงู ุญูู ุชุฎูููุง ุงูุฃุดูุงุก ๐๏ธ",
  "ูุง ุดูุก ูุณุงูู ุทูุจุฉ ูููุจูู ๐",
  "ุงูุฏููุง ุชุชุฒููโฆ ุญูู ุชุจุชุณููู ๐",
  "ุฃูุชู ุงูุณุชุฑ ุญูู ูุดุชุฏ ุงูุชุนุจ ๐ค",
  "ุญูู ูุฑุงูู ุจุฎูุฑโฆ ููุณู ุชุนุจูุง ๐ฟ",
  "ุฃูุชู ุฏุนูุฉ ุตุงุฏูุฉโฆ ูุฐูุฑู ุฌูููุฉ ๐",
  "ุงููุฑุจ ูููู ูุนููููุง ุฃู ุงูุฎูุฑ ูุง ูุฒุงู ููุฌูุฏูุง โจ",
  "ุฃูุชู ูุฑุฏุฉ ุงูุฃูุงูโฆ ูุฑุงุญุฉ ุงูููุจ ๐น",
  "ูู ุญุถูุฑูู ุชุชุจุฏูู ุงููููู ุฅูู ุณูููุฉ ๐๏ธ",
  "ูู ูุญุธุฉ ูุนููโฆ ููุง ูุนูู ๐ธ",
  "ุฃูุชู ุฃุฌูู ูุง ูููุฏู ูุฃููุณูุง: ุตุญุจุฉ ุทูุจุฉ ๐ค",
  "ุงูููู ุงุญูุธููโฆ ูุจุงุฑู ูููู ๐ฟ",
  "ุฃูุชู ุงููุตุฉ ุงูุฌูููุฉ ุงูุชู ูุง ูููููุง ๐ซ",
  "ูุจูู ุงูุฃุซุฑโฆ ููุจููู ุฃูุชู ูู ุงูููุจ โค๏ธ"
];

async function react(sock, message, emoji) {
  try {
    await sock.sendMessage(message.key.remoteJid, {
      react: { text: emoji, key: message.key }
    });
  } catch {}
}

async function shayariCommand(sock, message) {
  const chatId = message.key.remoteJid;
  const lang = getLang(chatId);

  const TXT = {
    en: {
      btn1: '๐ช Shayari',
      btn2: '๐น RoseDay',
      failed: 'โ Failed to fetch shayari. Please try again later.'
    },
    ar: {
      btn1: '๐ช ุดูุนุฑ',
      btn2: '๐น ููู ุงููุฑุฏ',
      failed: 'โ ุญุตู ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุดูุนุฑ'
    }
  };

  const T = TXT[lang] || TXT.en;

  try {
    await react(sock, message, '๐ช');

    let text = '';

    if (lang === 'ar') {
      text = SHAYARI_AR[Math.floor(Math.random() * SHAYARI_AR.length)];
    } else {
      const res = await fetch('https://shizoapi.onrender.com/api/texts/shayari?apikey=shizo', {
        headers: { 'User-Agent': 'Mozilla/5.0' }
      });
      if (!res.ok) throw new Error('API_ERROR');
      const data = await res.json();
      text = data?.result || 'No shayari found.';
    }

    const buttons = [
      { buttonId: '.shayari', buttonText: { displayText: T.btn1 }, type: 1 },
      { buttonId: '.roseday', buttonText: { displayText: T.btn2 }, type: 1 }
    ];

    await sock.sendMessage(
      chatId,
      { text, buttons, headerType: 1 },
      { quoted: message }
    );

    await react(sock, message, 'โ');
  } catch (err) {
    console.error('shayari error:', err?.message || err);
    await react(sock, message, 'โ');
    await sock.sendMessage(chatId, { text: T.failed }, { quoted: message });
  }
}

module.exports = {
  name: 'shayari',
  aliases: ['shayari', 'ุดุนุฑ', 'ุฎูุงุทุฑ', 'poem'],
  category: {
    ar: '๐ฏ ุฃูุงูุฑ ุงูุชุฑููู',
    en: '๐ฏ Fun Commands'
  },
  description: {
    ar: 'ูุฑุณู ุดูุนุฑ/ุฎุงุทุฑุฉ ุนุดูุงุฆูุฉ ุญุณุจ ูุบุฉ ุงูุฌุฑูุจ.',
    en: 'Send a random shayari/poem based on group language.'
  },
  usage: {
    ar: '.shayari',
    en: '.shayari'
  },
  emoji: 'โ๏ธ',
  admin: false,
  owner: false,
  showInMenu: true,
  exec: shayariCommand,
  run: shayariCommand,
  execute: shayariCommand
};