const fs = require('fs');
const path = require('path');
const { getLang } = require('../lib/lang');

const UPDATE_MSG_PATH = path.join(process.cwd(), 'data', 'update_message.json');

function buildUpdateMessage(chatId) {
  const lang = getLang(chatId) === 'ar' ? 'ar' : 'en';

  try {
    if (!fs.existsSync(UPDATE_MSG_PATH)) return null;

    const data = JSON.parse(fs.readFileSync(UPDATE_MSG_PATH, 'utf8'));
    const cfg = data?.[lang];
    if (!cfg) return null;

    const lines = [];
    if (cfg.title) lines.push(cfg.title);
    if (cfg.header) lines.push('\n' + cfg.header);

    if (Array.isArray(cfg.points)) {
      for (const p of cfg.points) {
        lines.push(`â€¢ ${p}`);
      }
    }

    return lines.join('\n');
  } catch {
    return null;
  }
}